# Codebase Dump - 20260101_184509

Root: /Users/sikandar/Desktop/projects/AgenticDS
Ignored: .git, node_modules, venv, binary files, etc.

## File: .gitignore

```txt
# Python
__pycache__/
*.pyc
*.pyo
*.pyd
.Python
env/
venv/
.venv/
pip-log.txt
pip-delete-this-directory.txt
.tox/
.coverage
.coverage.*
.cache
nosetests.xml
coverage.xml
*.cover
*.log
.pytest_cache/

# Node
node_modules/
dist/
build/
coverage/
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.npm/

# Mac
.DS_Store

# IDE
.vscode/
.idea/

# Environment
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# Docker
docker-compose.override.yml

# Project specific
backend/input_images/
backend/output_images/

```

## File: debug_run.sh

```sh
#!/bin/bash
echo "Starting debug run" > debug_log.txt
python3 --version >> debug_log.txt 2>&1
python3 collect.py >> debug_log.txt 2>&1
echo "Finished debug run" >> debug_log.txt

```

## File: docker-compose.yml

```yml
version: '3.8'

services:
  # PostgreSQL Database
  postgres:
    image: postgres:16-alpine
    environment:
      POSTGRES_USER: dsm_user
      POSTGRES_PASSWORD: dsm_password
      POSTGRES_DB: dsm_db
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready -U dsm_user -d dsm_db" ]
      interval: 10s
      timeout: 5s
      retries: 5

  # Redis Cache
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    healthcheck:
      test: [ "CMD", "redis-cli", "ping" ]
      interval: 10s
      timeout: 5s
      retries: 5

  # Backend API
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    env_file:
      - ./backend/.env
    environment:
      DATABASE_URL: postgresql://dsm_user:dsm_password@postgres:5432/dsm_db
      REDIS_URL: redis://redis:6379
    ports:
      - "8000:8000"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./backend:/app
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload

  # Frontend Dashboard
  dashboard:
    build:
      context: ./dashboard
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    depends_on:
      - backend
    volumes:
      - ./dashboard:/app/dashboard
      - /app/dashboard/node_modules
    command: npm run dev

  # Nginx Reverse Proxy
  nginx:
    image: nginx:alpine
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    ports:
      - "80:80"
    depends_on:
      - backend
      - dashboard

volumes:
  postgres_data:


networks:
  default:
    name: dsm_network

```

## File: git_setup.sh

```sh
#!/bin/bash
# Initialize git repository
git init

# Add all files
git add .

# Initial commit
git commit -m "Initial commit"

# Rename branch to main
git branch -M main

# Add remote origin
git remote add origin https://github.com/ali050786/agenticDS.git

# Push to origin
git push -u origin main

```

## File: nginx.conf

```conf
events {
    worker_connections 1024;
}

http {
    upstream backend {
        server backend:8000;
    }

    upstream dashboard {
        server dashboard:3000;
    }

    server {
        listen 80;
        server_name localhost;

        # API endpoints
        location /api {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Dashboard
        location / {
            proxy_pass http://dashboard;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }
    }
}

```

## File: startup.sh

```sh
#!/bin/bash

# Ensure script halts on error
set -e

echo "üöÄ Starting Agentic Design System Platform..."

# Check if Docker is running
if ! docker info > /dev/null 2>&1; then
  echo "Error: Docker is not running. Please start Docker Desktop and try again."
  exit 1
fi

echo "üì¶ Building and starting containers..."
docker-compose up --build

```

## File: backend/Dockerfile

```dockerfile
FROM python:3.11-slim

WORKDIR /app

RUN pip install --no-cache-dir poetry

COPY pyproject.toml poetry.lock* ./


RUN poetry config virtualenvs.create false

RUN poetry install --no-interaction --no-ansi --no-root

COPY . .

CMD ["poetry", "run", "uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]

```

## File: backend/debug_state.py

```py
import urllib.request
import json

BASE_URL = "http://localhost:8000"

def check_state():
    print(f"Checking state at {BASE_URL}...")
    try:
        with urllib.request.urlopen(f"{BASE_URL}/api/design-system/latest") as response:
            if response.status != 200:
                print(f"Error: Status {response.status}")
                return
            
            data = json.loads(response.read().decode('utf-8'))
            print("\n--- Current Design System ---")
            print(f"ID: {data.get('id')}")
            print(f"Version: {data.get('version')}")
            print(f"Updated At: {data.get('updated_at')}")
            
            components = data.get("components", [])
            print(f"\nComponents ({len(components)}):")
            for c in components:
                print(f" - {c.get('name')} (id: {c.get('id')})")
                
            if any(c.get('name') == 'Container' for c in components):
                print("\n‚úÖ 'Container' component found.")
            else:
                print("\n‚ùå 'Container' component NOT found.")

    except urllib.error.HTTPError as e:
        print(f"HTTP Error: {e.code} - {e.reason}")
        if e.code == 404:
            print("No design system found.")
    except Exception as e:
        print(f"Error: {e}")

if __name__ == "__main__":
    check_state()

```

## File: backend/main.py

```py
from fastapi import FastAPI, HTTPException, Depends, Request
from fastapi.middleware.cors import CORSMiddleware
from sqlalchemy.orm import Session
from typing import Dict, Any, List
import uuid
from datetime import datetime
from database.connection import get_db, engine, Base
from database.models import DesignSystem
from rendering.universal_renderer import UniversalRenderer

# Create tables
Base.metadata.create_all(bind=engine)

app = FastAPI(title="Agentic Design System API")

# CORS Configuration
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

def get_org_id(request: Request) -> str:
    # TODO: Implement actual auth extraction
    return "test-org-1"

@app.get("/health")
async def health_check():
    return {"status": "healthy", "service": "backend"}

@app.get("/")
async def root():
    return {"message": "Agentic Design System API is running"}

# ============================================================================
# DESIGN SYSTEM MANAGEMENT
# ============================================================================

@app.post("/api/design-system/ingest")
async def ingest_design_system(design_system: dict, request: Request, db: Session = Depends(get_db)):
    """
    Receive design system from Figma plugin
    Store in database with versioning
    """
    try:
        version = f"v{datetime.now().strftime('%Y%m%d_%H%M%S')}"
        
        # Store in database
        db_system = DesignSystem(
            id=str(uuid.uuid4()),
            name=design_system.get('name', 'Untitled'),
            version=version,
            tokens=design_system['tokens'],
            components=design_system['components'],
            organization_id=get_org_id(request),
            created_at=datetime.now(),
            updated_at=datetime.now()
        )
        db.add(db_system)
        db.commit()
        db.refresh(db_system)
        
        return {
            "status": "success",
            "message": f"Design system ingested as {version}",
            "design_system_id": db_system.id,
            "version": version
        }
    except Exception as e:
        return {"status": "error", "message": str(e)}

@app.get("/api/design-system/latest")
async def get_latest_design_system(request: Request, db: Session = Depends(get_db)):
    """Retrieve latest design system version"""
    try:
        org_id = get_org_id(request)
        latest = db.query(DesignSystem)\
            .filter(DesignSystem.organization_id == org_id)\
            .order_by(DesignSystem.updated_at.desc())\
            .first()
        
        if not latest:
            raise HTTPException(status_code=404, detail="No design system found")
        
        return {
            "id": latest.id,
            "version": latest.version,
            "tokens": latest.tokens,
            "components": latest.components,
            "created_at": latest.created_at,
            "updated_at": latest.updated_at
        }
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.get("/api/design-system/versions")
async def get_design_system_versions(request: Request, db: Session = Depends(get_db)):
    """Get all versions of design system"""
    try:
        org_id = get_org_id(request)
        versions = db.query(DesignSystem)\
            .filter(DesignSystem.organization_id == org_id)\
            .order_by(DesignSystem.created_at.desc())\
            .all()
        
        return {
            "status": "success",
            "versions": [
                {
                    "id": v.id,
                    "version": v.version,
                    "created_at": v.created_at,
                    "updated_at": v.updated_at
                }
                for v in versions
            ]
        }
    except Exception as e:
        return {"status": "error", "message": str(e)}

# ============================================================================
# SANDBOX GENERATION
# ============================================================================

from agents.sandbox_agent import SandboxAgent
from pydantic import BaseModel

class GenerateRequest(BaseModel):
    prompt: str

@app.post("/api/sandbox/generate")
async def generate_screen(request: GenerateRequest, http_req: Request, db: Session = Depends(get_db)):
    """Generate screen from prompt"""
    try:
        org_id = get_org_id(http_req)
        
        # Get latest design system
        latest_ds = db.query(DesignSystem)\
            .filter(DesignSystem.organization_id == org_id)\
            .order_by(DesignSystem.updated_at.desc())\
            .first()
            
        if not latest_ds:
             # Fallback to a mock empty system if none exists to avoid crash
             design_system_dict = {"tokens": {}, "components": []}
        else:
             # Convert SQLAlchemy model to dict
             design_system_dict = {
                 "tokens": latest_ds.tokens,
                 "components": latest_ds.components
             }
             print(f"DEBUG: Loaded Design System Version: {latest_ds.version}")
             print(f"DEBUG: Components found: {[c['name'] for c in latest_ds.components]}")
        
        agent = SandboxAgent(design_system_dict)
        result = await agent.generate_screen(request.prompt)
        
        return result
        
    except Exception as e:
        return {"status": "error", "message": str(e)}

```

## File: backend/pyproject.toml

```toml
[tool.poetry]
name = "agentic-ds-backend"
version = "0.1.0"
description = "Backend for Agentic Design System"
authors = ["Admin <admin@example.com>"]

[tool.poetry.dependencies]
python = "^3.11"
fastapi = "^0.109.0"
uvicorn = "^0.27.0"
sqlalchemy = "^2.0.25"
psycopg2-binary = "^2.9.9"
redis = "^5.0.1"
python-multipart = "^0.0.9"
langchain = "^0.1.0"
langchain-openai = "^0.0.5"

[tool.poetry.group.dev.dependencies]
pytest = "^8.0.0"

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"

```

## File: backend/requirements.txt

```txt
fastapi>=0.109.0
uvicorn>=0.27.0
sqlalchemy>=2.0.25
psycopg2-binary>=2.9.9
redis>=5.0.1
python-multipart>=0.0.9
httpx>=0.27.0

```

## File: backend/seed_database.py

```py
import urllib.request
import json
import sys

BASE_URL = "http://localhost:8000"

def seed_database():
    print(f"Seeding database at {BASE_URL}...")
    
    payload = {
        "name": "Seeded Design System",
        "tokens": {
            "colors": [
                {"name": "primary/500", "value": "#3B82F6"},
                {"name": "neutral/100", "value": "#F3F4F6"},
                {"name": "neutral/900", "value": "#111827"}
            ],
            "typography": [
                 {"name": "body/md", "fontFamily": "Inter", "fontSize": 16, "fontWeight": 400}
            ],
            "spacing": [
                 {"name": "spacing/4", "value": "1rem"}
            ]
        },
        "components": [
             {"name": "Button", "id": "seed-btn"},
             {"name": "Container", "id": "seed-container"},
             {"name": "Text", "id": "seed-text"},
             {"name": "Input", "id": "seed-input"}
        ]
    }
    
    req = urllib.request.Request(
        f"{BASE_URL}/api/design-system/ingest",
        data=json.dumps(payload).encode('utf-8'),
        headers={'Content-Type': 'application/json'}
    )
    
    try:
        with urllib.request.urlopen(req) as response:
            if response.status == 200:
                data = json.loads(response.read().decode('utf-8'))
                print("‚úÖ Database seeded successfully!")
                print(f"Design System ID: {data.get('design_system_id')}")
                print(f"Version: {data.get('version')}")
            else:
                print(f"‚ùå Failed to seed database. Status: {response.status}")

    except Exception as e:
        print(f"‚ùå Error seeding database: {e}")

if __name__ == "__main__":
    seed_database()

```

## File: backend/test_api_ingest.py

```py
import urllib.request
import json
import sys

BASE_URL = "http://localhost:8000"

def test_integration():
    print(f"Testing against running API at {BASE_URL}...")
    
    # 1. Ingest
    payload = {
        "name": "Integration Test System",
        "tokens": {
            "colors": [{"name": "primary", "value": "#FF0000"}],
            "typography": [],
            "spacing": []
        },
        "components": [
             {"name": "Button", "id": "123"},
             {"name": "Container", "id": "124"},
             {"name": "Text", "id": "125"},
             {"name": "Input", "id": "126"}
        ]
    }
    
    req = urllib.request.Request(
        f"{BASE_URL}/api/design-system/ingest",
        data=json.dumps(payload).encode('utf-8'),
        headers={'Content-Type': 'application/json'}
    )
    
    try:
        with urllib.request.urlopen(req) as response:
            print(f"Ingest Status: {response.status}")
            data = json.loads(response.read().decode('utf-8'))
            print(f"Ingest Response: {data}")
            
            if response.status != 200:
                print("FAILED: Ingest returned non-200")
                return

            design_system_id = data.get("design_system_id")
            if not design_system_id:
                print("FAILED: No design_system_id returned")
                return
                
            print(f"Design System ID: {design_system_id}")

            # 2. Get Tokens
            print("\nFetching Tokens...")
            with urllib.request.urlopen(f"{BASE_URL}/api/tokens?design_system_id={design_system_id}") as token_response:
                 print(f"Tokens Status: {token_response.status}")
                 tokens = json.loads(token_response.read().decode('utf-8'))
                 print(f"Tokens Response: {tokens}")
                 
                 if token_response.status == 200 and len(tokens.get("colors", [])) > 0:
                     if tokens["colors"][0]["name"] == "primary":
                        print("\n‚úÖ SUCCESS: Full flow verified against running Docker container.")
                     else:
                        print("\n‚ùå FAILED: Token name mismatch.")
                 else:
                     print("\n‚ùå FAILED: Token verification failed.")

    except urllib.error.URLError as e:
        print(f"\n‚ùå FAILED: Could not connect to {BASE_URL}. Is Docker running? Error: {e}")
        print("Note: If Docker is running, make sure port 8000 is exposed.")
    except Exception as e:
        print(f"\n‚ùå FAILED: Unexpected error: {e}")

if __name__ == "__main__":
    test_integration()

```

## File: backend/test_renderer.py

```py
import json
import sys
import os

# Ensure backend acts as package root if running directly
current_dir = os.path.dirname(os.path.abspath(__file__))
parent_dir = os.path.dirname(current_dir)
if parent_dir not in sys.path:
    sys.path.insert(0, parent_dir)
if current_dir not in sys.path:
    sys.path.insert(0, current_dir)

try:
    from backend.rendering.universal_renderer import UniversalRenderer
except ImportError:
    try:
        from rendering.universal_renderer import UniversalRenderer
    except ImportError:
        print("Error: Could not import UniversalRenderer. Make sure you are running from the project root or backend directory.")
        sys.exit(1)

def test_renderer():
    # Mock Design System
    mock_design_system = {
        "tokens": {
            "colors": [
                {"name": "primary/500", "value": "#3B82F6"},
                {"name": "neutral/100", "value": "#F3F4F6"}
            ],
            "typography": [
                {"name": "body/md", "fontFamily": "Inter", "fontSize": 16, "fontWeight": 400}
            ],
            "spacing": [
                {"name": "spacing/4", "value": "1rem"}
            ]
        },
        "components": [
            {"name": "Container", "id": "1"},
            {"name": "Button", "id": "2"},
            {"name": "Text", "id": "3"}
        ]
    }

    # Mock Design Specification
    mock_spec = {
        "type": "Container",
        "props": {
            "background": "neutral/100",
            "padding": "spacing/4"
        },
        "children": [
            {
                "type": "Text",
                "props": {
                    "color": "primary/500"
                },
                "content": "Hello World"
            },
            {
                "type": "Button",
                "props": {
                    "variant": "primary"
                },
                "content": "Click Me"
            }
        ]
    }

    print("Initializing UniversalRenderer...")
    renderer = UniversalRenderer(mock_design_system)

    print("Rendering specification...")
    try:
        result = renderer.render_design_specification(mock_spec)
        
        print("\n--- Generated JSX ---")
        print(result["jsx"])
        
        print("\n--- Metadata ---")
        print("Tokens Used:", result["tokens_used"])
        print("Components Used:", result["components_used"])
        print("Valid:", result["valid"])

        # Expected output check (rough)
        assert "<Container" in result["jsx"]
        assert 'background="#F3F4F6"' in result["jsx"]
        assert 'padding="1rem"' in result["jsx"]
        assert "<Text" in result["jsx"]
        assert 'color="#3B82F6"' in result["jsx"]
        assert "Hello World" in result["jsx"]
        assert "<Button" in result["jsx"]
        assert "Click Me" in result["jsx"]
        
        print("\n‚úÖ Verification Successful: Output matches expected structure.")

    except Exception as e:
        print(f"\n‚ùå Verification Failed: {e}")
        import traceback
        traceback.print_exc()
        sys.exit(1)

if __name__ == "__main__":
    test_renderer()

```

## File: backend/test_sandbox_api.py

```py
import urllib.request
import json
import sys

BASE_URL = "http://localhost:8000"

def test_sandbox():
    print(f"Testing Sandbox Agent at {BASE_URL}...")
    
    payload = {
        "prompt": "Create a login card"
    }
    
    req = urllib.request.Request(
        f"{BASE_URL}/api/sandbox/generate",
        data=json.dumps(payload).encode('utf-8'),
        headers={'Content-Type': 'application/json'}
    )
    
    try:
        print("Sending request to LLM (this may take a few seconds)...")
        with urllib.request.urlopen(req) as response:
            print(f"Status: {response.status}")
            data = json.loads(response.read().decode('utf-8'))
            
            if response.status != 200:
                print(f"FAILED: API returned non-200. Response: {data}")
                return

            if data.get("status") == "error":
                print(f"FAILED: Agent returned error: {data.get('message')}")
                return

            print("\n--- Generated Design ---")
            print(json.dumps(data.get("design"), indent=2))
            
            print("\n--- Generated Code ---")
            print(data.get("code"))
            
            print("\n--- Metadata ---")
            print(f"Tokens Used: {data.get('tokens_used')}")
            
            if data.get("code") and "<Container" in data.get("code"):
                 print("\n‚úÖ SUCCESS: Sandbox Agent generated valid code.")
            else:
                 print("\n‚ö†Ô∏è WARNING: Code might vary based on LLM output, but response was received.")

    except urllib.error.URLError as e:
        print(f"\n‚ùå FAILED: Could not connect to {BASE_URL}. Is Docker running? Error: {e}")
    except Exception as e:
        print(f"\n‚ùå FAILED: Unexpected error: {e}")

if __name__ == "__main__":
    test_sandbox()

```

## File: backend/agents/__init__.py

```py

```

## File: backend/agents/sandbox_agent.py

```py
from typing import Dict, Any, List, Optional
import json
import os
from langchain_openai import ChatOpenAI
from rendering.universal_renderer import UniversalRenderer

class SandboxAgent:
    """
    Generates new screen designs from text prompts
    Constrained to use ONLY design system tokens and components
    """

    def __init__(self, design_system: Dict[str, Any]):
        self.design_system = design_system
        self.renderer = UniversalRenderer(design_system)
        
        # Use OpenRouter
        api_key = os.getenv("OPENROUTER_API_KEY") 
        # Fallback to OpenAI key if OpenRouter not explicit
        if not api_key:
            api_key = os.getenv("OPENAI_API_KEY")
        
        # If still no key, use a placeholder to pass Pydantic validation
        # (OpenRouter free models might work, or it will fail with 401 later which is better than crash)
        if not api_key:
            api_key = "sk-or-v1-placeholder"

        self.llm = ChatOpenAI(
            model="tngtech/deepseek-r1t2-chimera:free",
            openai_api_key=api_key,
            openai_api_base="https://openrouter.ai/api/v1",
            temperature=0
        )

    async def generate_screen(self, prompt: str) -> Dict[str, Any]:
        """Generate a screen design from natural language prompt"""
        
        # Format design system for LLM
        ds_context = self._format_design_system_for_llm()
        
        # Create constraint-enhanced prompt
        constraint_prompt = f"""
You are a UI designer that ONLY uses the provided design system.
You MUST use ONLY tokens and components from this design system.
You CANNOT create custom colors, fonts, spacing, or components.

DESIGN SYSTEM:
{ds_context}

USER REQUEST:
{prompt}

Generate a JSON specification for a screen that:
1. Uses ONLY colors from the design system
2. Uses ONLY typography from the design system
3. Uses ONLY components from the design system
4. Uses ONLY spacing values from the design system
5. Is responsive and accessible
6. Matches the user's request

Return ONLY valid JSON, no other text. Do not wrap in markdown code blocks.

JSON Schema:
{{
  "type": "Container",
  "props": {{"background": "color-token-or-value"}},
  "children": [
    {{
      "type": "AnotherAvailableComponent",
      "props": {{"variant": "primary"}},
      "content": "Text content"
    }}
  ]
}}
"""

        # Generate design specification
        response = await self.llm.apredict(constraint_prompt)
        
        print(f"DEBUG LLM RESPONSE: {response}")
        
        # Robust JSON cleaning: extract substring from first { to last }
        clean_response = response.strip()
        start_idx = clean_response.find("{")
        end_idx = clean_response.rfind("}")
        
        if start_idx != -1 and end_idx != -1:
            clean_response = clean_response[start_idx : end_idx + 1]
        else:
            # Fallback to simple strip if braces not found (unlikely for valid JSON)
            if clean_response.startswith("```json"):
                clean_response = clean_response[7:]
            if clean_response.startswith("```"):
                clean_response = clean_response[3:]
            if clean_response.endswith("```"):
                clean_response = clean_response[:-3]
            
        try:
            design_spec = json.loads(clean_response)
        except json.JSONDecodeError as e:
            # Fallback/Error handling
            return {
                "status": "error",
                "message": f"Failed to parse LLM response: {e}",
                "raw_response": response
            }

        # Validate against design system
        try:
            self.renderer.validate_specification(design_spec)
        except ValueError as e:
             return {
                "status": "error",
                "message": f"Validation failed: {e}",
                "design": design_spec
            }
        
        # Render (get JSX + preview metadata)
        rendered = self.renderer.render_design_specification(design_spec)
        
        return {
            "status": "success",
            "design": design_spec,
            "code": rendered["jsx"],
            "tokens_used": rendered["tokens_used"],
            "components_used": rendered["components_used"],
            "prompt": prompt
        }

    def _format_design_system_for_llm(self) -> str:
        """Format design system in readable format for LLM"""
        parts = []
        
        # Colors
        colors_str = "\n".join([
            f"  - {t['name']}: {t['value']}"
            for t in self.design_system['tokens'].get('colors', [])
        ])
        parts.append(f"COLORS:\n{colors_str}")
        
        # Typography
        typo_str = "\n".join([
            f"  - {t['name']}: {t['fontFamily']} {t['fontSize']}px {t['fontWeight']}"
            for t in self.design_system['tokens'].get('typography', [])
        ])
        parts.append(f"TYPOGRAPHY:\n{typo_str}")
        
        # Components
        comp_str = "\n".join([
            f"  - {c['name']}"
            for c in self.design_system.get('components', [])
        ])
        parts.append(f"COMPONENTS:\n{comp_str}")
        
        return "\n\n".join(parts)

```

## File: backend/database/__init__.py

```py

```

## File: backend/database/connection.py

```py
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker, declarative_base
import os

DATABASE_URL = os.getenv("DATABASE_URL", "postgresql://dsm_user:dsm_password@localhost:5432/dsm_db")

engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

Base = declarative_base()

def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

```

## File: backend/database/models.py

```py
from sqlalchemy import Column, String, DateTime, JSON, Integer
from database.connection import Base
from datetime import datetime

class DesignSystem(Base):
    __tablename__ = "design_systems"
    
    id: str = Column(String, primary_key=True)
    name: str = Column(String)
    version: str = Column(String)
    organization_id: str = Column(String)
    tokens: dict = Column(JSON)
    components: list = Column(JSON)
    created_at: datetime = Column(DateTime, default=datetime.now)
    updated_at: datetime = Column(DateTime, default=datetime.now, onupdate=datetime.now)

class GeneratedScreen(Base):
    __tablename__ = "generated_screens"
    
    id: str = Column(String, primary_key=True)
    design_system_id: str = Column(String)
    prompt: str = Column(String)
    design_spec: dict = Column(JSON)
    code: str = Column(String)
    tokens_used: list = Column(JSON)
    components_used: list = Column(JSON)
    created_at: datetime = Column(DateTime, default=datetime.now)

class DesignToken(Base):
    __tablename__ = "design_tokens"
    
    id: str = Column(String, primary_key=True)
    design_system_id: str = Column(String)
    name: str = Column(String)
    type: str = Column(String)  # color, typography, spacing
    value: dict = Column(JSON)
    created_at: datetime = Column(DateTime, default=datetime.now)
    updated_at: datetime = Column(DateTime, default=datetime.now, onupdate=datetime.now)

```

## File: backend/rendering/__init__.py

```py

```

## File: backend/rendering/universal_renderer.py

```py
from typing import Dict, Any, List, Optional
import json

class UniversalRenderer:
    """
    Renders design specifications for:
    1. Display (show tokens, components)
    2. Edit (preview changes)
    3. Sandbox (generate screens)
    4. Code Generation (Figma to code)
    """

    def __init__(self, design_system: Dict[str, Any]):
        self.design_system = design_system
        self.tokens = self._index_tokens()
        self.components = self._index_components()

    def render_design_specification(self, spec: Dict[str, Any]) -> Dict[str, Any]:
        """
        Convert design specification to JSX code and preview
        
        Used by:
        - Display system
        - Edit preview
        - Sandbox generation
        - Code generation
        """
        # Validate specification uses only design system
        self.validate_specification(spec)
        
        # Convert to JSX
        jsx_code = self.specification_to_jsx(spec)
        
        # Extract metadata
        used_tokens = self.extract_tokens_from_spec(spec)
        used_components = self.extract_components_from_spec(spec)
        
        return {
            "jsx": jsx_code,
            "specification": spec,
            "tokens_used": used_tokens,
            "components_used": used_components,
            "valid": True
        }

    def specification_to_jsx(self, spec: Dict[str, Any], depth: int = 0) -> str:
        """Recursively convert design spec to JSX"""
        component_type = spec.get('type')
        props = spec.get('props', {})
        children = spec.get('children', [])
        content = spec.get('content', '')

        # Validate component exists
        if not self._component_exists(component_type):
            raise ValueError(f"Component '{component_type}' not found in design system")

        # Resolve props (map token references to values)
        jsx_props = self._resolve_props(props)
        
        # Build JSX string
        indent = '  ' * depth
        
        if children:
            children_jsx = '\n'.join([
                self.specification_to_jsx(child, depth + 1) 
                for child in children
            ])
            return f"{indent}<{component_type} {jsx_props}>\n{children_jsx}\n{indent}</{component_type}>"
        elif content:
            return f"{indent}<{component_type} {jsx_props}>{content}</{component_type}>"
        else:
            return f"{indent}<{component_type} {jsx_props} />"

    def validate_specification(self, spec: Dict[str, Any]) -> bool:
        """Ensure spec only uses design system tokens and components"""
        def validate_node(node):
            component_type = node.get('type')
            if not self._component_exists(component_type):
                available = list(self.components.keys())
                raise ValueError(f"Component '{component_type}' not in design system. Available: {available}")
            
            props = node.get('props', {})
            for key, value in props.items():
                if self._is_token_reference(value):
                    if value not in self.tokens:
                        raise ValueError(f"Token '{value}' not found in design system")
            
            children = node.get('children', [])
            for child in children:
                validate_node(child)
        
        validate_node(spec)
        return True

    def _resolve_props(self, props: Dict[str, Any]) -> str:
        """Convert props to JSX attributes"""
        parts = []
        for key, value in props.items():
            if isinstance(value, str):
                if self._is_token_reference(value):
                    token_value = self._resolve_token(value)
                    parts.append(f'{key}="{token_value}"')
                else:
                    parts.append(f'{key}="{value}"')
            elif isinstance(value, bool):
                if value:
                    parts.append(key)
            elif isinstance(value, (int, float)):
                parts.append(f'{key}={value}')
        return ' '.join(parts)

    def _is_token_reference(self, value: str) -> bool:
        """Check if value references a token (e.g., 'primary/500')"""
        return isinstance(value, str) and '/' in value

    def _resolve_token(self, token_name: str) -> str:
        """Get actual value of token"""
        if token_name in self.tokens:
            return self.tokens[token_name].get('value', token_name)
        raise ValueError(f"Token '{token_name}' not found")

    def _component_exists(self, component_name: str) -> bool:
        """Check if component exists in design system"""
        return component_name in self.components

    def _index_tokens(self) -> Dict[str, Dict]:
        """Create searchable index of all tokens"""
        index = {}
        for token_type in ['colors', 'typography', 'spacing']:
            tokens = self.design_system['tokens'].get(token_type, [])
            for token in tokens:
                index[token.get('name')] = token
        return index

    def _index_components(self) -> Dict[str, Dict]:
        """Create searchable index of all components"""
        index = {}
        for component in self.design_system.get('components', []):
            index[component.get('name')] = component
        return index

    def extract_tokens_from_spec(self, spec: Dict[str, Any]) -> List[str]:
        """Extract all token references from specification"""
        tokens = set()
        
        def extract_from_node(node):
            props = node.get('props', {})
            for value in props.values():
                if self._is_token_reference(value) and value in self.tokens:
                    tokens.add(value)
            
            for child in node.get('children', []):
                extract_from_node(child)
        
        extract_from_node(spec)
        return list(tokens)

    def extract_components_from_spec(self, spec: Dict[str, Any]) -> List[str]:
        """Extract all component references from specification"""
        components = set()
        
        def extract_from_node(node):
            component_type = node.get('type')
            if component_type and self._component_exists(component_type):
                components.add(component_type)
            
            for child in node.get('children', []):
                extract_from_node(child)
        
        extract_from_node(spec)
        return list(components)

```

## File: dashboard/Dockerfile

```dockerfile
FROM node:20-alpine

WORKDIR /app

COPY package*.json ./

# Using npm install instead of npm ci since lockfile might not exist yet for user
RUN npm install

COPY . .

EXPOSE 3000

CMD ["npm", "run", "dev"]

```

## File: dashboard/index.html

```html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Agentic DS Dashboard</title>
  </head>
  <body>
    <div id="root"><h1>Agentic Design System Dashboard is Running!</h1></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>

```

## File: dashboard/package.json

```json
{
    "name": "agentic-ds-dashboard",
    "private": true,
    "version": "0.0.0",
    "type": "module",
    "scripts": {
        "dev": "vite --host",
        "build": "tsc && vite build",
        "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
        "preview": "vite preview"
    },
    "dependencies": {
        "react": "^18.2.0",
        "react-dom": "^18.2.0"
    },
    "devDependencies": {
        "@types/react": "^18.2.43",
        "@types/react-dom": "^18.2.17",
        "@vitejs/plugin-react": "^4.2.1",
        "autoprefixer": "^10.4.16",
        "postcss": "^8.4.33",
        "tailwindcss": "^3.4.1",
        "typescript": "^5.2.2",
        "vite": "^5.0.8"
    }
}
```

## File: dashboard/postcss.config.js

```js
export default {
    plugins: {
        tailwindcss: {},
        autoprefixer: {},
    },
}

```

## File: dashboard/tailwind.config.js

```js
/** @type {import('tailwindcss').Config} */
export default {
    content: [
        "./index.html",
        "./src/**/*.{js,ts,jsx,tsx}",
    ],
    theme: {
        extend: {},
    },
    plugins: [],
}

```

## File: dashboard/tsconfig.json

```json
{
    "compilerOptions": {
        "target": "ES2020",
        "useDefineForClassFields": true,
        "lib": [
            "ES2020",
            "DOM",
            "DOM.Iterable"
        ],
        "module": "ESNext",
        "skipLibCheck": true,
        /* Bundler mode */
        "moduleResolution": "bundler",
        "allowImportingTsExtensions": true,
        "resolveJsonModule": true,
        "isolatedModules": true,
        "noEmit": true,
        "jsx": "react-jsx",
        /* Linting */
        "strict": true,
        "noUnusedLocals": true,
        "noUnusedParameters": true,
        "noFallthroughCasesInSwitch": true
    },
    "include": [
        "src"
    ],
    "exclude": [
        "node_modules"
    ]
}
```

## File: dashboard/vite.config.ts

```ts
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vitejs.dev/config/
export default defineConfig({
    plugins: [react()],
    server: {
        host: true, // Needed for Docker
        port: 3000,
        watch: {
            usePolling: true,
        },
    }
})

```

## File: dashboard/src/App.tsx

```tsx
import React, { useState } from 'react';
import { useDesignSystem } from './hooks/useDesignSystem';
import { DesignSystemRenderer } from './components/DesignSystemRenderer';
import { Sandbox } from './components/Sandbox';

function App() {
    const { designSystem, loading, error } = useDesignSystem();
    const [activeTab, setActiveTab] = useState<'explorer' | 'sandbox'>('explorer');

    if (loading) {
        return (
            <div className="flex items-center justify-center min-h-screen bg-gray-50">
                <div className="text-xl font-semibold text-gray-600">Loading Design System...</div>
            </div>
        );
    }

    if (error) {
        return (
            <div className="flex items-center justify-center min-h-screen bg-red-50">
                <div className="text-red-600 border border-red-200 bg-white p-6 rounded shadow-sm">
                    <h2 className="text-lg font-bold mb-2">Error Loading Design System</h2>
                    <p>{error}</p>
                    <p className="text-sm mt-4 text-gray-500">Ensure the backend is running at http://localhost:8000</p>
                </div>
            </div>
        );
    }

    return (
        <div className="min-h-screen bg-gray-50 text-gray-900 font-sans">
            {/* Navigation Bar */}
            <div className="bg-white border-b border-gray-200">
                <div className="max-w-7xl mx-auto px-6">
                    <div className="flex space-x-8">
                        <button
                            onClick={() => setActiveTab('explorer')}
                            className={`py-4 px-2 border-b-2 font-medium text-sm transition-colors ${activeTab === 'explorer'
                                    ? 'border-blue-500 text-blue-600'
                                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                }`}
                        >
                            Design System Explorer
                        </button>
                        <button
                            onClick={() => setActiveTab('sandbox')}
                            className={`py-4 px-2 border-b-2 font-medium text-sm transition-colors ${activeTab === 'sandbox'
                                    ? 'border-blue-500 text-blue-600'
                                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                }`}
                        >
                            Sandbox
                        </button>
                    </div>
                </div>
            </div>

            <div className="max-w-7xl mx-auto py-8">
                {activeTab === 'explorer' ? (
                    <DesignSystemRenderer designSystem={designSystem} mode="display" />
                ) : (
                    <Sandbox />
                )}
            </div>
        </div>
    );
}

export default App;

```

## File: dashboard/src/index.css

```css
@tailwind base;
@tailwind components;
@tailwind utilities;
```

## File: dashboard/src/main.tsx

```tsx
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App'
import './index.css'

ReactDOM.createRoot(document.getElementById('root')!).render(
    <React.StrictMode>
        <App />
    </React.StrictMode>,
)

```

## File: dashboard/src/vite-env.d.ts

```ts
/// <reference types="vite/client" />

```

## File: dashboard/src/components/DesignSystemRenderer.tsx

```tsx
import React from 'react';

interface DesignSystemRendererProps {
    designSystem: any;
    mode: 'display' | 'edit';
}

const ColorToken = ({ name, value }: { name: string, value: string }) => (
    <div className="flex items-center space-x-2 p-2 rounded border border-gray-200">
        <div
            className="w-8 h-8 rounded border border-gray-300"
            style={{ backgroundColor: value }}
        />
        <div>
            <div className="font-semibold text-sm">{name}</div>
            <div className="text-xs text-gray-500">{value}</div>
        </div>
    </div>
);

const TypographyToken = ({ token }: { token: any }) => (
    <div className="p-4 rounded border border-gray-200">
        <div className="font-semibold text-sm mb-2">{token.name}</div>
        <div style={{
            fontFamily: token.fontFamily || 'inherit',
            fontWeight: token.fontWeight || 400,
            fontSize: token.fontSize ? `${token.fontSize}px` : '16px',
            lineHeight: token.lineHeight ? `${token.lineHeight}px` : '1.5',
        }}>
            The quick brown fox jumps over the lazy dog
        </div>
        <div className="mt-2 text-xs text-gray-500 grid grid-cols-2 gap-2">
            {Object.entries(token).map(([key, val]) => {
                if (key === 'name') return null;
                return (
                    <div key={key}>
                        <span className="font-medium">{key}:</span> {String(val)}
                    </div>
                );
            })}
        </div>
    </div>
);

const Section = ({ title, children }: { title: string, children: React.ReactNode }) => (
    <div className="mb-8">
        <h3 className="font-bold text-lg mb-4 capitalize border-b pb-2">{title}</h3>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {children}
        </div>
    </div>
);

const ComponentTreeRenderer = ({ node }: { node: any }) => {
    if (!node) return null;

    // Handle string content
    if (typeof node === 'string') return <span>{node}</span>;

    const { type, props, content, children } = node;

    // safeProps ensures we don't pass undefined/null to style if not intended or handle style mapping
    const style: React.CSSProperties = { ...props?.style };

    // Simple mapping of "Design System" components to HTML/Tailwind
    // In a real app, these would be your actual React components

    if (type === 'Container') {
        const bg = props?.background || props?.backgroundColor || 'transparent';
        const p = props?.padding || '1rem';
        return (
            <div style={{ backgroundColor: bg, padding: p, ...style }} className="border border-dashed border-gray-300 rounded">
                {content && <div>{content}</div>}
                {children && children.map((child: any, i: number) => <ComponentTreeRenderer key={i} node={child} />)}
            </div>
        );
    }

    if (type === 'Button') {
        // Fallback for primary/secondary logic if tokens aren't resolved here (simplification)
        const variant = props?.variant === 'primary' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800';
        // Allow direct color override if provided (heuristic)
        const styleOverride = { ...style };
        if (props?.backgroundColor) styleOverride.backgroundColor = props.backgroundColor;

        return (
            <button className={`px-4 py-2 rounded ${variant}`} style={styleOverride}>
                {content || props?.label || 'Button'}
            </button>
        );
    }

    if (type === 'Text') {
        return (
            <p style={style} className="my-2">
                {content || props?.children}
            </p>
        );
    }

    if (type === 'Input') {
        return (
            <input
                type="text"
                placeholder={props?.placeholder || 'Input'}
                className="border p-2 rounded w-full"
                style={style}
            />
        );
    }

    // Default fallback
    return (
        <div className="p-2 border border-red-200 bg-red-50 text-red-800 text-xs">
            Unknown Component: {type}
        </div>
    );
};

export const DesignSystemRenderer: React.FC<DesignSystemRendererProps> = ({ designSystem }) => {
    if (!designSystem) {
        return <div className="p-4 text-gray-500">No content loaded.</div>;
    }

    // Heuristic: If it has "type" (like "Container"), treat as component tree
    if (designSystem.type) {
        return (
            <div className="p-8 border border-gray-200 rounded-lg shadow-sm bg-white min-h-[400px]">
                <ComponentTreeRenderer node={designSystem} />
            </div>
        );
    }

    const { tokens, components } = designSystem;

    return (
        <div className="space-y-8 p-6">
            <h1 className="text-3xl font-bold border-b pb-4">Design System Explorer</h1>

            {/* Metadata */}
            <div className="text-sm text-gray-500 flex space-x-4">
                <span>Version: {designSystem.version}</span>
                <span>Last Updated: {designSystem.updated_at ? new Date(designSystem.updated_at).toLocaleString() : 'N/A'}</span>
            </div>

            {/* Tokens */}
            {tokens && (
                <div className="space-y-6">
                    <h2 className="text-2xl font-semibold">Tokens</h2>

                    {tokens.colors && Array.isArray(tokens.colors) && (
                        <Section title="Colors">
                            {tokens.colors.map((color: any, idx: number) => (
                                <ColorToken key={idx} name={color.name} value={color.value} />
                            ))}
                        </Section>
                    )}

                    {tokens.typography && Array.isArray(tokens.typography) && (
                        <Section title="Typography">
                            {tokens.typography.map((typo: any, idx: number) => (
                                <TypographyToken key={idx} token={typo} />
                            ))}
                        </Section>
                    )}

                    {tokens.spacing && Array.isArray(tokens.spacing) && (
                        <Section title="Spacing">
                            {tokens.spacing.map((space: any, idx: number) => (
                                <div key={idx} className="p-2 border border-gray-200 rounded">
                                    <div className="font-semibold">{space.name}</div>
                                    <div className="text-gray-500">{space.value}</div>
                                    <div className="mt-1 h-4 bg-gray-200" style={{ width: space.value }}></div>
                                </div>
                            ))}
                        </Section>
                    )}
                </div>
            )}

            {/* Components fallback or list */}
            {components && Array.isArray(components) && (
                <div className="space-y-6">
                    <h2 className="text-2xl font-semibold">Components</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {components.map((comp: any, idx: number) => (
                            <div key={idx} className="p-4 border rounded shadow-sm">
                                <h3 className="font-bold">{comp.name}</h3>
                                <div className="text-xs text-gray-500">ID: {comp.id}</div>
                            </div>
                        ))}
                    </div>
                </div>
            )}

            {/* Fallback for generic structure if not matching above */}
            {!tokens && !components && (
                <pre className="bg-gray-100 p-4 rounded overflow-auto text-xs">
                    {JSON.stringify(designSystem, null, 2)}
                </pre>
            )}
        </div>
    );
};

```

## File: dashboard/src/components/Sandbox.tsx

```tsx
import React, { useState } from 'react';
import { DesignSystemRenderer } from './DesignSystemRenderer';

const API_BASE_URL = 'http://localhost:8000';

export const Sandbox: React.FC = () => {
    const [prompt, setPrompt] = useState('');
    const [loading, setLoading] = useState(false);
    const [result, setResult] = useState<any>(null);
    const [error, setError] = useState<string | null>(null);

    const handleGenerate = async () => {
        if (!prompt.trim()) return;

        setLoading(true);
        setError(null);
        setResult(null);

        try {
            const response = await fetch(`${API_BASE_URL}/api/sandbox/generate`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ prompt }),
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(errorData.detail || 'Failed to generate design');
            }

            const data = await response.json();
            console.log('Sandbox generation response:', data);

            if (data.status === 'error') {
                throw new Error(data.message || 'Backend service reported an error');
            }

            setResult(data);
        } catch (err: any) {
            console.error('Generation failed:', err);
            setError(err.message || 'An unknown error occurred');
        } finally {
            setLoading(false);
        }
    };

    return (
        <div className="space-y-8">
            <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                <h2 className="text-xl font-bold mb-4">Sandbox Generator</h2>
                <div className="flex gap-4">
                    <input
                        type="text"
                        value={prompt}
                        onChange={(e) => setPrompt(e.target.value)}
                        placeholder="Describe the UI you want effectively (e.g., 'A login form with email and password')"
                        className="flex-1 p-3 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none"
                        onKeyDown={(e) => e.key === 'Enter' && handleGenerate()}
                    />
                    <button
                        onClick={handleGenerate}
                        disabled={loading || !prompt.trim()}
                        className={`px-6 py-3 rounded font-medium text-white transition-colors ${loading || !prompt.trim()
                            ? 'bg-blue-300 cursor-not-allowed'
                            : 'bg-blue-600 hover:bg-blue-700'
                            }`}
                    >
                        {loading ? 'Generating...' : 'Generate'}
                    </button>
                </div>
                {error && (
                    <div className="mt-4 p-3 bg-red-50 text-red-700 rounded border border-red-200">
                        {error}
                    </div>
                )}
            </div>

            {result && (
                <div className="space-y-8 animate-fade-in">
                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <h3 className="text-lg font-semibold mb-4 text-gray-700">Preview</h3>
                        <DesignSystemRenderer designSystem={result.design} mode="display" />
                    </div>

                    <div className="bg-gray-900 text-gray-100 p-6 rounded-lg shadow-sm overflow-hidden">
                        <h3 className="text-lg font-semibold mb-4 text-gray-300">Generated Code</h3>
                        <pre className="overflow-x-auto text-sm font-mono whitespace-pre-wrap">
                            {result.code}
                        </pre>
                    </div>
                </div>
            )}
        </div>
    );
};

```

## File: dashboard/src/hooks/useDesignSystem.ts

```ts
import { useState, useEffect } from 'react';

export function useDesignSystem() {
    const [designSystem, setDesignSystem] = useState<any>(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState<string | null>(null);

    useEffect(() => {
        const fetchDesignSystem = async () => {
            try {
                const response = await fetch('http://localhost:8000/api/design-system/latest');
                if (!response.ok) {
                    throw new Error('Failed to fetch design system');
                }
                const data = await response.json();
                setDesignSystem(data);
            } catch (err: any) {
                setError(err.message);
            } finally {
                setLoading(false);
            }
        };

        fetchDesignSystem();
    }, []);

    return { designSystem, loading, error };
}

```

## File: plugin/code.js

```js
"use strict";
(() => {
  // src/extractors/colors.ts
  var extractColors = () => {
    return figma.getLocalPaintStyles().map((style) => {
      const paint = style.paints[0];
      if (paint.type === "SOLID") {
        const { r, g, b } = paint.color;
        return {
          name: style.name,
          value: `rgb(${Math.round(r * 255)}, ${Math.round(g * 255)}, ${Math.round(b * 255)})`,
          description: style.description
        };
      }
      return null;
    }).filter(Boolean);
  };

  // src/extractors/typography.ts
  var extractTypography = () => {
    return figma.getLocalTextStyles().map((style) => ({
      name: style.name,
      fontFamily: style.fontName.family,
      fontSize: style.fontSize,
      fontWeight: style.fontName.style,
      lineHeight: style.lineHeight.unit === "AUTO" ? "auto" : style.lineHeight.value
    }));
  };

  // src/code.ts
  figma.showUI(__html__, { width: 400, height: 600 });
  figma.ui.onmessage = async (msg) => {
    if (msg.type === "collect-data") {
      const colors = extractColors();
      const typography = extractTypography();
      const components = figma.root.findAllWithCriteria({
        types: ["COMPONENT", "COMPONENT_SET"]
      }).map((c) => ({
        id: c.id,
        name: c.name,
        description: c.description || "",
        type: c.type
      }));
      const designSystem = {
        version: "1.0.0",
        lastUpdated: (/* @__PURE__ */ new Date()).toISOString(),
        tokens: {
          colors,
          typography,
          spacing: []
          // Will be extracted from components later
        },
        components
      };
      console.log("Design System Extracted:", designSystem);
      figma.ui.postMessage({ type: "data-collected", data: designSystem });
    }
  };
})();

```

## File: plugin/manifest.json

```json
{
    "name": "Agentic Design System",
    "id": "agentic-ds-plugin",
    "api": "1.0.0",
    "main": "code.js",
    "ui": "src/ui.html",
    "capabilities": [],
    "enableProposedApi": false,
    "editorType": [
        "figma"
    ]
}
```

## File: plugin/package.json

```json
{
    "name": "agentic-ds-plugin",
    "version": "1.0.0",
    "description": "Figma plugin for Agentic Design System",
    "main": "code.js",
    "scripts": {
        "build": "esbuild src/code.ts --bundle --outfile=code.js",
        "watch": "npm run build -- --watch"
    },
    "dependencies": {},
    "devDependencies": {
        "@figma/plugin-typings": "^1.84.0",
        "esbuild": "^0.19.11",
        "typescript": "^5.3.3"
    }
}
```

## File: plugin/tsconfig.json

```json
{
    "compilerOptions": {
        "target": "es6",
        "lib": [
            "es6",
            "dom"
        ],
        "strict": true,
        "typeRoots": [
            "./node_modules/@types",
            "./node_modules/@figma"
        ],
        "outDir": ".",
        "module": "commonjs",
        "rootDir": "./src",
        "skipLibCheck": true
    },
    "include": [
        "src/**/*.ts"
    ],
    "exclude": [
        "node_modules",
        "dist"
    ]
}
```

## File: plugin/extractors/colors.js

```js
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.extractColors = void 0;
const extractColors = () => {
    return figma.getLocalPaintStyles().map(style => {
        const paint = style.paints[0];
        if (paint.type === 'SOLID') {
            const { r, g, b } = paint.color;
            return {
                name: style.name,
                value: `rgb(${Math.round(r * 255)}, ${Math.round(g * 255)}, ${Math.round(b * 255)})`,
                description: style.description
            };
        }
        return null;
    }).filter(Boolean);
};
exports.extractColors = extractColors;

```

## File: plugin/extractors/typography.js

```js
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.extractTypography = void 0;
const extractTypography = () => {
    return figma.getLocalTextStyles().map(style => ({
        name: style.name,
        fontFamily: style.fontName.family,
        fontSize: style.fontSize,
        fontWeight: style.fontName.style,
        lineHeight: style.lineHeight.unit === 'AUTO' ? 'auto' : style.lineHeight.value
    }));
};
exports.extractTypography = extractTypography;

```

## File: plugin/src/code.ts

```ts
import { extractColors } from './extractors/colors';
import { extractTypography } from './extractors/typography';

figma.showUI(__html__, { width: 400, height: 600 });

figma.ui.onmessage = async (msg) => {
    if (msg.type === 'collect-data') {
        const colors = extractColors();
        const typography = extractTypography();

        const components = figma.root.findAllWithCriteria({
            types: ['COMPONENT', 'COMPONENT_SET']
        }).map(c => ({
            id: c.id,
            name: c.name,
            description: (c as ComponentNode).description || '',
            type: c.type
        }));

        const designSystem = {
            version: '1.0.0',
            lastUpdated: new Date().toISOString(),
            tokens: {
                colors,
                typography,
                spacing: [] // Will be extracted from components later
            },
            components
        };

        console.log('Design System Extracted:', designSystem);
        figma.ui.postMessage({ type: 'data-collected', data: designSystem });
    }
};

```

## File: plugin/src/ui.html

```html
<!DOCTYPE html>
<html>

<head>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            text-align: center;
        }

        h2 {
            margin-bottom: 20px;
        }

        button {
            background-color: #18A0FB;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0D8DE3;
        }

        #status {
            margin-top: 20px;
            font-size: 12px;
            color: #555;
        }
    </style>
</head>

<body>
    <h2>Agentic Design System</h2>
    <button id="collect">Collect Design System</button>
    <div id="status"></div>

    <script>
        document.getElementById('collect').onclick = () => {
            parent.postMessage({ pluginMessage: { type: 'collect-data' } }, '*');
        }

        onmessage = (event) => {
            const msg = event.data.pluginMessage;
            if (msg.type === 'data-collected') {
                const count = msg.data.tokens.colors.length + msg.data.tokens.typography.length;
                document.getElementById('status').innerText = `Collected ${count} tokens & ${msg.data.components.length} components. check console`;
            }
        }
    </script>
</body>

</html>
```

## File: plugin/src/extractors/colors.ts

```ts
export const extractColors = () => {
    return figma.getLocalPaintStyles().map(style => {
        const paint = style.paints[0];
        if (paint.type === 'SOLID') {
            const { r, g, b } = paint.color;
            return {
                name: style.name,
                value: `rgb(${Math.round(r * 255)}, ${Math.round(g * 255)}, ${Math.round(b * 255)})`,
                description: style.description
            };
        }
        return null;
    }).filter(Boolean);
};

```

## File: plugin/src/extractors/typography.ts

```ts
export const extractTypography = () => {
    return figma.getLocalTextStyles().map(style => ({
        name: style.name,
        fontFamily: style.fontName.family,
        fontSize: style.fontSize,
        fontWeight: style.fontName.style,
        lineHeight: style.lineHeight.unit === 'AUTO' ? 'auto' : style.lineHeight.value
    }));
};

```

